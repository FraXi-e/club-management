<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>IIIT-NR Club Management</title>
	<meta name="description" content="Explore IIIT-NR clubs, manage memberships, and track events." />
	<meta name="theme-color" content="#4f46e5" />
	<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>🎓</text></svg>">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
    
	<script src="https://cdn.tailwindcss.com"></script>
	
	<style>
			   
		body {
	 background-image: url('IIIT NR.jpg');
/* Replace with your image path */
			background-size: cover; /* Fill the viewport */
			background-position: center; /* Align image to left bottom */
			background-repeat: no-repeat; /* Prevents tiling */
			background-attachment: fixed; /* Keeps background fixed while scrolling */
			min-height: 100vh;
			margin: 0;
			width: 100%;
		}







		@keyframes gradientFlow {
			0%, 100% { background-position: 0% 50%; }
			50% { background-position: 100% 50%; }
		}
		
		@keyframes fadeInUp {
			from {
				opacity: 0;
				transform: translateY(30px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}
		
		@keyframes scaleIn {
			from {
				opacity: 0;
				transform: scale(0.9);
			}
			to {
				opacity: 1;
				transform: scale(1);
			}
		}

		@keyframes shimmer {
			0% { background-position: -1000px 0; }
			100% { background-position: 1000px 0; }
		}
		
		:root { 
			font-family: 'Inter', system-ui, -apple-system, sans-serif;
			--primary: #4f46e5;
			--primary-dark: #4338ca;
			--secondary: #06b6d4;
			--accent: #10b981;
		}

		* {
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
		}

		body {
			background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
			min-height: 100vh;
		}

		html[data-theme="dark"] body { 
			background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
			color: #e2e8f0; 
		}
		
		html[data-theme="dark"] .card { 
			background: linear-gradient(145deg, #1e293b 0%, #334155 100%);
			border-color: #334155;
			box-shadow: 0 8px 32px rgba(0,0,0,.4);
		}

		html[data-theme="dark"] .input {
			background: #1e293b;
			border-color: #334155;
			color: #e2e8f0;
		}

		html[data-theme="dark"] .label {
			color: #cbd5e1;
		}

		.card {
			background: white;
			border: 1px solid #e5e7eb;
			border-radius: 20px;
			padding: 1.5rem;
			box-shadow: 0 4px 20px rgba(0,0,0,.06);
			transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
			animation: scaleIn 0.5s ease-out;
			position: relative;
			overflow: hidden;
		}

		.card::before {
			content: '';
			position: absolute;
			top: 0;
			left: -100%;
			width: 100%;
			height: 100%;
			background: linear-gradient(90deg, transparent, rgba(255,255,255,.2), transparent);
			transition: left 0.5s;
		}

		.card:hover::before {
			left: 100%;
		}

		.card:hover {
			transform: translateY(-4px);
			box-shadow: 0 16px 40px rgba(0,0,0,.12);
			border-color: rgba(79, 70, 229, 0.4);
		}

		.btn {
			display: inline-flex;
			align-items: center;
			justify-content: center;
			gap: 0.5rem;
			border-radius: 12px;
			font-weight: 600;
			padding: .75rem 1.5rem;
			box-shadow: 0 2px 8px rgba(0,0,0,.1);
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			position: relative;
			overflow: hidden;
			border: none;
			cursor: pointer;
			font-size: 0.95rem;
			letter-spacing: 0.02em;
		}

		.btn::before {
			content: '';
			position: absolute;
			top: 50%;
			left: 50%;
			width: 0;
			height: 0;
			border-radius: 50%;
			background: rgba(255,255,255,.3);
			transform: translate(-50%, -50%);
			transition: width 0.6s, height 0.6s;
		}

		.btn:hover::before {
			width: 300px;
			height: 300px;
		}

		.btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(0,0,0,.15);
		}

		.btn:active {
			transform: translateY(0);
			box-shadow: 0 2px 8px rgba(0,0,0,.1);
		}

		.input { 
			width:100%; 
			padding:.875rem 1.125rem; 
			border:2px solid #e5e7eb; 
			border-radius:12px; 
			outline: none; 
			transition: all 0.3s ease;
			background: white;
			font-size: 0.95rem;
		}

		.input:focus { 
			box-shadow: 0 0 0 4px rgba(79,70,229,.1); 
			border-color:#6366f1; 
			background: white;
		}

		.label { 
			font-size:.875rem; 
			font-weight:600; 
			color:#374151; 
			margin-bottom:.5rem; 
			display:block;
			letter-spacing: 0.02em;
		}

		.text-muted { 
			color:#64748b; 
			line-height: 1.6;
		}

		.badge { 
			font-size:.7rem; 
			padding:.35rem .75rem; 
			border-radius:8px; 
			font-weight:700; 
			letter-spacing:.05em; 
			text-transform:uppercase;
			white-space: nowrap;
		}

		.line-clamp-2 { 
			display: -webkit-box; 
			-webkit-line-clamp: 2; 
			-webkit-box-orient: vertical; 
			overflow: hidden; 
		}

		#site-logo { 
			width:48px; 
			height:48px; 
			object-fit:contain; 
			border-radius:12px;
			box-shadow: 0 2px 8px rgba(0,0,0,.1);
		}

		.hero-section {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			border-radius: 24px;
			position: relative;
			overflow: hidden;
		}

		.hero-section::before {
			content: '';
			position: absolute;
			top: -50%;
			right: -50%;
			width: 200%;
			height: 200%;
			background: radial-gradient(circle, rgba(255,255,255,.1) 0%, transparent 70%);
			animation: float 20s ease-in-out infinite;
		}

		@keyframes float {
			0%, 100% { transform: translate(0, 0) rotate(0deg); }
			50% { transform: translate(-30px, -30px) rotate(180deg); }
		}

		.glass-effect {
			background: rgba(255, 255, 255, 0.1);
			backdrop-filter: blur(10px);
			border: 1px solid rgba(255, 255, 255, 0.2);
		}

		.stats-card {
			background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
			border-radius: 16px;
			padding: 1.5rem;
			border: 1px solid #e2e8f0;
			transition: all 0.3s ease;
		}

		.stats-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 12px 32px rgba(0,0,0,.08);
		}

		html[data-theme="dark"] .stats-card {
			background: linear-gradient(145deg, #1e293b 0%, #334155 100%);
			border-color: #334155;
		}

		.club-icon-wrapper {
			width: 56px;
			height: 56px;
			border-radius: 16px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 1.5rem;
			box-shadow: 0 4px 12px rgba(0,0,0,.1);
			transition: all 0.3s ease;
		}

		.card:hover .club-icon-wrapper {
			transform: scale(1.1) rotate(5deg);
		}

		.animate-stagger {
			opacity: 0;
			animation: fadeInUp 0.6s ease-out forwards;
		}

		html {
			scroll-behavior: smooth;
		}

		/* Enhanced header */
		header {
			backdrop-filter: blur(10px);
			background: linear-gradient(135deg, rgba(14, 116, 144, 0.95) 0%, rgba(16, 185, 129, 0.95) 100%);
			border-bottom: 1px solid rgba(255,255,255,.2);
		}

		/* Side menu improvements */
		#side-menu {
			backdrop-filter: blur(20px);
		}

		html[data-theme="dark"] #side-menu {
			background: rgba(30, 41, 59, 0.98);
		}

		.menu-item {
			transition: all 0.2s ease;
			border-left: 3px solid transparent;
		}

		.menu-item:hover {
			border-left-color: #6366f1;
			background: rgba(99, 102, 241, 0.1);
			transform: translateX(4px);
		}

		/* Loading state */
		.skeleton {
			background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
			background-size: 200% 100%;
			animation: shimmer 1.5s infinite;
			border-radius: 8px;
		}

		/* Improved scrollbar */
		::-webkit-scrollbar {
			width: 10px;
		}

		::-webkit-scrollbar-track {
			background: #f1f5f9;
		}

		::-webkit-scrollbar-thumb {
			background: #cbd5e1;
			border-radius: 5px;
		}

		::-webkit-scrollbar-thumb:hover {
			background: #94a3b8;
		}

		html[data-theme="dark"] ::-webkit-scrollbar-track {
			background: #1e293b;
		}

		html[data-theme="dark"] ::-webkit-scrollbar-thumb {
			background: #475569;
		}
	</style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
	<!-- Header -->
	<header class="shadow-lg sticky top-0 z-20">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col sm:flex-row justify-between items-center" style="animation: fadeInUp 0.6s ease-out;">
			<div class="flex items-center gap-4 w-full sm:w-auto justify-between sm:justify-start">
				<!-- Hamburger Menu Button -->
				<button id="menu-btn" class="relative z-30 flex flex-col justify-center items-center gap-1.5 p-3 hover:bg-white/20 rounded-xl transition-all duration-300 group">
					<span class="w-6 h-0.5 bg-white rounded-full transition-all duration-300"></span>
					<span class="w-6 h-0.5 bg-white rounded-full transition-all duration-300"></span>
					<span class="w-6 h-0.5 bg-white rounded-full transition-all duration-300"></span>
				</button>
				
				<a href="#/" class="flex items-center gap-3">
					<img src="iiitnr_logo.jpg" alt="IIIT-NR" id="site-logo" onerror="this.style.display='none'" />
					<div class="flex items-center gap-3">
						<span class="text-xl sm:text-2xl font-bold text-white tracking-tight">IIIT-NR Club Hub</span>
					</div>
				</a>
			</div>

			<nav class="mt-3 sm:mt-0 flex items-center gap-4 text-sm font-medium text-white">
				<div class="hidden sm:flex items-center gap-4">
					<a href="#/" class="hover:text-white/80 transition duration-200 px-3 py-2 rounded-lg hover:bg-white/10">Home</a>
					<a href="#/create" class="hover:text-white/80 transition duration-200 px-3 py-2 rounded-lg hover:bg-white/10">New Club</a>
				</div>
				<div class="flex items-center gap-3">
					<div id="digital-clocks" class="hidden md:block text-right text-white text-xs leading-none bg-white/10 px-3 py-2 rounded-lg backdrop-blur">
						<div class="flex gap-4">
							<div>
								<div class="text-[9px] text-white/70 uppercase tracking-wider">Local</div>
								<div id="digital-local" class="font-mono text-sm font-semibold">--:--:--</div>
							</div>
							<div>
								<div class="text-[9px] text-white/70 uppercase tracking-wider">UTC</div>
								<div id="digital-utc" class="font-mono text-sm font-semibold">--:--:--</div>
							</div>
						</div>
					</div>
					<span id="hello-user" class="hidden sm:flex items-center gap-2 bg-white/15 px-4 py-2 rounded-xl backdrop-blur">
						<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
							<path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
						</svg>
						<span id="current-user-name" class="font-semibold text-sm">Student</span>
					</span>
				</div>
			</nav>
		</div>
	</header>

	<!-- Side Menu Panel -->
	<div id="side-menu" class="fixed top-0 left-0 h-full w-72 bg-white dark:bg-gray-800 shadow-2xl transform -translate-x-full transition-transform duration-300 ease-in-out z-20">
		<div class="p-6 space-y-6">
			<div class="flex justify-between items-center">
				<h3 class="text-lg font-bold text-gray-800 dark:text-white">Menu</h3>
				<button id="close-menu" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all duration-200">
					<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
					</svg>
				</button>
			</div>
			<div class="space-y-2">
				<a href="#/" class="menu-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 dark:text-gray-200">
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
					</svg>
					Home
				</a>
				<a href="#/create" class="menu-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 dark:text-gray-200">
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
					</svg>
					New Club
				</a>
				<button id="side-settings-btn" class="menu-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 dark:text-gray-200">
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
					</svg>
					Settings
				</button>
				<button id="side-theme-toggle" class="menu-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 dark:text-gray-200">
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
					</svg>
					<span id="theme-toggle-text">Dark Mode</span>
				</button>
				<div id="side-auth-actions" class="space-y-2 pt-4 border-t border-gray-200 dark:border-gray-700"></div>
			</div>
		</div>
	</div>
	
	<!-- Backdrop -->
	<div id="menu-backdrop" class="fixed inset-0 bg-black/50 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300 z-10"></div>

	<!-- Main -->
	<main id="app" class="flex-grow max-w-7xl mx-auto w-full p-4 sm:p-6 lg:p-8">
		<!-- Content will be injected here -->
	</main>

	<!-- Footer -->
	<footer class="border-t border-gray-200 dark:border-gray-700 mt-12 bg-white/50 dark:bg-gray-900/50 backdrop-blur">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
			<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
				<div>
					<h4 class="font-bold text-gray-800 dark:text-white mb-3">IIIT-NR Club Hub</h4>
					<p class="text-sm text-gray-600 dark:text-gray-400">Building smart projects, learning together, and turning ideas into reality.</p>
				</div>
				<div>
					<h4 class="font-bold text-gray-800 dark:text-white mb-3">Quick Links</h4>
					<ul class="space-y-2 text-sm">
						<li><a class="text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 transition" href="#/">Home</a></li>
						<li><a class="text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 transition" href="#/create">Create Club</a></li>
						<li><a class="text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 transition" href="#/support">Support</a></li>
					</ul>
				</div>
				<div>
					<h4 class="font-bold text-gray-800 dark:text-white mb-3">Legal</h4>
					<ul class="space-y-2 text-sm">
						<li><a class="text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 transition" href="#">Privacy Policy</a></li>
						<li><a class="text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 transition" href="#">Terms of Service</a></li>
						<li><a class="text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 transition" href="#">Contact</a></li>
					</ul>
				</div>
			</div>
			<div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center text-sm text-gray-600 dark:text-gray-400">
				<p>&copy; 2025 IIIT-NR. All rights reserved.</p>
			</div>
		</div>
	</footer>

	<script>
		// Storage keys
		const STORAGE_KEYS = {
			clubs: 'iiitnr.clubs',
			events: 'iiitnr.events',
			currentUser: 'iiitnr.currentUser',
			theme: 'iiitnr.theme'
		};

		const API_BASE = (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')
			? 'http://localhost:5000/api'
			: '/api';
		let backendAvailable = false;

		// API helpers
		async function apiGet(path) {
			const res = await fetch(API_BASE + path, { headers: { 'Content-Type': 'application/json' } });
			if (!res.ok) throw new Error(`GET ${path} failed: ${res.status}`);
			return res.json();
		}
		async function apiPost(path, body) {
			const res = await fetch(API_BASE + path, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
			if (!res.ok) throw new Error(`POST ${path} failed: ${res.status}`);
			return res.json();
		}
		async function apiDelete(path) {
			const res = await fetch(API_BASE + path, { method: 'DELETE' });
			if (!res.ok) throw new Error(`DELETE ${path} failed: ${res.status}`);
			return res.json();
		}
		async function apiPut(path, body) {
			const res = await fetch(API_BASE + path, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
			if (!res.ok) throw new Error(`PUT ${path} failed: ${res.status}`);
			return res.json();
		}

		// Default clubs data
		const DEFAULT_CLUBS = [
			{ name: 'AIML', leaderName: 'Dr. A. Sharma', description: 'Explore Artificial Intelligence and Machine Learning—projects, papers, meetups.', events: [ { title: 'Intro to ML', date: '2025-10-15', description: 'Kickoff session on ML fundamentals.' } ] },
			{ name: 'DEV CLUB', leaderName: 'Priya Verma', description: 'Developers club focusing on web, mobile, and open source projects.', events: [ { title: 'Open Source Sprint', date: '2025-11-12', description: 'Contribute to OSS together.' } ] },
			{ name: 'TSOC', leaderName: 'Rohan Mehta', description: 'Technical Society of IIIT-NR—talks, meetups, and skill building.', events: [ { title: 'Tech Talks Marathon', date: '2025-11-18', description: 'Lightning talks across domains.' } ] },
			{ name: 'MUN', leaderName: 'Aisha Khan', description: 'Model United Nations—debate, diplomacy, and global affairs.', events: [ { title: 'UN Sim 2025', date: '2025-12-01', description: 'Campus-wide MUN simulation.' } ] },
			{ name: 'SHUTTER BUG', leaderName: 'Neeraj Patel', description: 'Photography and visual storytelling—walks, edits, and showcases.', events: [ { title: 'Photo Walk', date: '2025-10-28', description: 'Blue hour campus walk.' } ] },
			{ name: 'IGNITERS', leaderName: 'Aryan Gupta', description: 'Dance club—choreography, workshops, and high-energy performances.', events: [ { title: 'Campus Dance Jam', date: '2025-11-05', description: 'Freestyle and choreography session.' } ] },
			{ name: 'CLUB DE THEATRE', leaderName: 'Meera Iyer', description: 'Theatre and dramatics—acting, direction, and stage production.', events: [ { title: 'Stagecraft 101', date: '2025-10-20', description: 'Workshop on theatre production.' } ] },
			{ name: 'AARAMBH(SPORTS CLUB)', leaderName: 'Kabir Singh', description: 'Sports and fitness—events, teams, and active campus life.', events: [ { title: 'Intra Sports Day', date: '2025-11-22', description: 'Track and field events.' } ] }
		];

		// Data functions
		async function loadFromBackendOrLocal() {
			try {
				const [clubsRaw, eventsRaw, membershipsRaw] = await Promise.all([
					apiGet('/clubs'),
					apiGet('/events'),
					apiGet('/memberships')
				]);

				const clubs = (clubsRaw || []).map(c => ({
					id: String(c.id || c._id),
					name: c.name,
					description: c.description || '',
					leaderId: c.ownerId || c.leaderId || null,
					leaderName: c.leaderName || null,
					memberIds: [],
					logo: c.logo || null,
					events: []
				}));
				const clubById = new Map(clubs.map(c => [String(c.id), c]));

				const flatEvents = (eventsRaw || []).map(e => ({
					id: String(e.id || e._id),
					title: e.title,
					description: e.description || '',
					date: e.datetime || e.date || null,
					clubId: String((e.clubId && (e.clubId.id || e.clubId._id)) || e.clubId || ''),
					rsvpUserIds: e.rsvps || []
				}));
				flatEvents.forEach(ev => {
					const club = clubById.get(String(ev.clubId));
					if (club) club.events.push(ev);
				});

				(membershipsRaw || []).forEach(m => {
					const cid = String(m.clubId);
					const uid = m.userId;
					const c = clubById.get(cid);
					if (c && uid && !c.memberIds.includes(uid)) c.memberIds.push(uid);
				});

				localStorage.setItem(STORAGE_KEYS.clubs, JSON.stringify(clubs));
				localStorage.setItem(STORAGE_KEYS.events, JSON.stringify(flatEvents));

				backendAvailable = true;
				console.info('Loaded data from backend API');
				return true;
			} catch (err) {
				console.info('Backend not reachable, using localStorage demo. Error:', err && err.message ? err.message : err);
				backendAvailable = false;
				return false;
			}
		}

		async function seedIfNeeded() {
			if (!localStorage.getItem(STORAGE_KEYS.clubs)) {
				const clubs = DEFAULT_CLUBS.map((c, idx) => ({
					id: String(idx + 1),
					name: c.name,
					description: c.description,
					leaderId: `u-${idx + 1}`,
					leaderName: c.leaderName || 'Club Leader',
					memberIds: [],
					logo: null,
					events: (c.events || []).map((e, i) => ({
						id: `e-${idx + 1}-${i + 1}`,
						title: e.title,
						description: e.description,
						date: e.date,
						rsvpUserIds: []
					}))
				}));
				localStorage.setItem(STORAGE_KEYS.clubs, JSON.stringify(clubs));
			}
			if (!localStorage.getItem(STORAGE_KEYS.currentUser)) {
				localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify({ id: 'u-1', name: 'Student User' }));
			}
		}

		function getCurrentUser() {
			const u = localStorage.getItem(STORAGE_KEYS.currentUser);
			return u ? JSON.parse(u) : null;
		}

		async function getClubs() { 
			await seedIfNeeded(); 
			return JSON.parse(localStorage.getItem(STORAGE_KEYS.clubs) || '[]'); 
		}

		async function getClubById(id) { 
			const clubs = await getClubs(); 
			return clubs.find(c => c.id === String(id)) || null; 
		}

		async function saveClubs(clubs) { 
			localStorage.setItem(STORAGE_KEYS.clubs, JSON.stringify(clubs)); 
		}

		async function createClub({ name, description, logo = null }) {
			const user = getCurrentUser();
			if (!user || (!isAdmin() && user.role !== 'student')) {
				alert('You must be logged in as an administrator or student to create a club.');
				return null;
			}

			if (user && backendAvailable) {
				try {
					const payload = { name, description, logo, ownerId: user.id };
					const c = await apiPost('/clubs', payload);
					try { await apiPost('/memberships', { userId: user.id, clubId: String(c.id || c._id) }); } catch(e) { }
					await loadFromBackendOrLocal();
					return { id: String(c.id || c._id), name: c.name, description: c.description, logo: c.logo };
				} catch (err) {
					console.warn('Create club via API failed, falling back to local:', err && err.message ? err.message : err);
				}
			}

			const clubs = await getClubs();
			const newId = String(clubs.length ? (parseInt(clubs[clubs.length - 1].id, 10) + 1) : 1);
			const leaderId = user?.id || null;
			const newClub = { id: newId, name, description, logo, leaderId, memberIds: [], events: [] };
			clubs.push(newClub); 
			await saveClubs(clubs); 
			return newClub;
		}

		async function joinClub(clubId) {
			const user = getCurrentUser();
			if (!user) { alert('Please login to join clubs'); return null; }

			if (backendAvailable) {
				try {
					await apiPost('/memberships', { userId: user.id, clubId });
					await loadFromBackendOrLocal();
					return (await getClubById(clubId));
				} catch (err) {
					console.warn('Backend join failed, falling back to local', err && err.message ? err.message : err);
				}
			}

			const clubs = await getClubs(); 
			const club = clubs.find(c => c.id === String(clubId));
			if (club && user && !club.memberIds.includes(user.id)) { 
				club.memberIds.push(user.id); 
				await saveClubs(clubs); 
			}
			return club;
		}

		async function leaveClub(clubId) {
			const user = getCurrentUser();
			if (!user) return null;

			if (backendAvailable) {
				try {
					const memberships = await apiGet('/memberships');
					const m = (memberships || []).find(x => String(x.clubId) === String(clubId) && x.userId === user.id);
					if (m) await apiDelete(`/memberships/${m.id}`);
					await loadFromBackendOrLocal();
					return (await getClubById(clubId));
				} catch (err) {
					console.warn('Backend leave failed, falling back to local', err && err.message ? err.message : err);
				}
			}

			const clubs = await getClubs(); 
			const club = clubs.find(c => c.id === String(clubId));
			if (club && user) { 
				club.memberIds = club.memberIds.filter(id => id !== user.id); 
				await saveClubs(clubs); 
			}
			return club;
		}

		async function addEventToClub(clubId, { title, description, date }) {
			if (backendAvailable) {
				try {
					const payload = { clubId, title, description, datetime: new Date(date).toISOString() };
					const ev = await apiPost('/events', payload);
					await loadFromBackendOrLocal();
					return { id: String(ev.id || ev._id), title: ev.title, description: ev.description, date: ev.datetime, rsvpUserIds: ev.rsvps || [] };
				} catch (err) { 
					console.warn('Backend add event failed, fallback local', err && err.message ? err.message : err); 
				}
			}

			const clubs = await getClubs(); 
			const club = clubs.find(c => c.id === String(clubId)); 
			if (!club) return null;
			const newEvent = { id: `e-${club.id}-${(club.events?.length || 0) + 1}`, title, description, date, rsvpUserIds: [] };
			club.events = club.events || []; 
			club.events.push(newEvent); 
			await saveClubs(clubs); 
			return newEvent;
		}

		async function updateClubLeaderName(clubId, leaderName) {
			const clubs = await getClubs();
			const club = clubs.find(c => c.id === String(clubId));
			if (!club) return null;
			club.leaderName = (leaderName || '').trim() || club.leaderName || 'Club Leader';
			await saveClubs(clubs);
			return club;
		}

		async function toggleEventRsvp(clubId, eventId) {
			const user = getCurrentUser(); 
			if (!user) { alert('Please login to RSVP'); return null; }

			if (backendAvailable) {
				try {
					const res = await apiPost(`/events/${eventId}/rsvp`, { userId: user.id });
					await loadFromBackendOrLocal();
					return res;
				} catch (err) { 
					console.warn('Backend RSVP failed, falling back local', err && err.message ? err.message : err); 
				}
			}

			const clubs = await getClubs(); 
			const club = clubs.find(c => c.id === String(clubId)); 
			if (!club) return null;
			const ev = (club.events || []).find(e => e.id === String(eventId)); 
			if (!ev) return null;
			const idx = ev.rsvpUserIds.indexOf(user.id); 
			if (idx === -1) ev.rsvpUserIds.push(user.id); 
			else ev.rsvpUserIds.splice(idx, 1);
			await saveClubs(clubs); 
			return ev;
		}

		async function updateEvent(eventId, { title, description, date }) {
			if (backendAvailable) {
				try {
					const payload = { title, description, datetime: new Date(date).toISOString() };
					const updated = await apiPut(`/events/${eventId}`, payload);
					await loadFromBackendOrLocal();
					return updated;
				} catch (err) { 
					console.warn('Backend event update failed, falling back local', err && err.message ? err.message : err); 
				}
			}

			const clubs = await getClubs();
			for (const club of clubs) {
				if (!club.events) continue;
				const ev = club.events.find(e => String(e.id) === String(eventId));
				if (ev) {
					ev.title = title; 
					ev.description = description; 
					ev.date = date;
					await saveClubs(clubs);
					return ev;
				}
			}
			return null;
		}

		async function deleteClub(clubId) {
			if (backendAvailable) {
				try { 
					await apiDelete(`/clubs/${clubId}`); 
					await loadFromBackendOrLocal(); 
					return true; 
				} catch (e) { 
					console.warn('Backend delete club failed', e); 
				}
			}

			const clubs = await getClubs();
			const idx = clubs.findIndex(c => String(c.id) === String(clubId));
			if (idx !== -1) { 
				clubs.splice(idx, 1); 
				await saveClubs(clubs); 
				return true; 
			}
			return false;
		}

		function getClubVisuals(name) {
			const n = (name || '').toUpperCase();
			if (n.includes('AIML')) return badge('🧠', 'AI/ML', 'bg-gradient-to-br from-violet-500 to-purple-600');
			if (n.includes('DEV')) return badge('💻', 'DEV', 'bg-gradient-to-br from-indigo-500 to-blue-600');
			if (n.includes('TSOC')) return badge('🧑‍💻', 'TECH', 'bg-gradient-to-br from-blue-500 to-cyan-600');
			if (n.includes('MUN')) return badge('🌍', 'DEBATE', 'bg-gradient-to-br from-cyan-500 to-teal-600');
			if (n.includes('SHUTTER BUG')) return badge('📷', 'PHOTO', 'bg-gradient-to-br from-amber-500 to-orange-600');
			if (n.includes('CAPRICIO')) return badge('🎵', 'MUSIC', 'bg-gradient-to-br from-pink-500 to-rose-600');
			if (n.includes('IGNITERS')) return badge('💃', 'DANCE', 'bg-gradient-to-br from-fuchsia-500 to-pink-600');
			if (n.includes('CLUB DE THEATRE')) return badge('🎭', 'THEATRE', 'bg-gradient-to-br from-rose-500 to-red-600');
			if (n.includes('AARAMBH') || n.includes('SPORT')) return badge('🏃', 'SPORTS', 'bg-gradient-to-br from-green-500 to-emerald-600');
			return badge('🎓', 'CLUB', 'bg-gradient-to-br from-slate-500 to-gray-600');
		}

		function badge(emoji, label, bg) {
			return { emoji, label, bg };
		}

		function getLeaderName(club) {
			return club.leaderName || 'Club Leader';
		}

		function isAdmin() {
			const user = getCurrentUser();
			return user?.role === 'admin';
		}

		const ADMIN_CREDENTIALS = {
			username: 'admin@iiitnr.ac.in',
			password: 'admin1234@'
		};

		function setUserInHeader() {
			const user = getCurrentUser();
			const el = document.getElementById('current-user-name');
			const hello = document.getElementById('hello-user');
			if (el && user) el.textContent = user.name;
			if (hello) hello.style.display = user ? 'flex' : 'none';
		}

		function applySavedTheme() {
			const saved = localStorage.getItem(STORAGE_KEYS.theme) || 'light';
			document.documentElement.setAttribute('data-theme', saved);
			const text = document.getElementById('theme-toggle-text');
			if (text) text.textContent = saved === 'dark' ? '☀️ Light Mode' : '🌙 Dark Mode';
		}

		function setupThemeToggle() {
			const btn = document.getElementById('side-theme-toggle');
			if (!btn) return;
			btn.addEventListener('click', () => {
				const current = document.documentElement.getAttribute('data-theme') || 'light';
				const next = current === 'dark' ? 'light' : 'dark';
				document.documentElement.setAttribute('data-theme', next);
				localStorage.setItem(STORAGE_KEYS.theme, next);
				const text = document.getElementById('theme-toggle-text');
				if (text) text.textContent = next === 'dark' ? '☀️ Light Mode' : '🌙 Dark Mode';
			});
		}

		function openOverlay(contentEl) {
			let overlay = document.getElementById('__iiitnr_overlay');
			if (!overlay) {
				overlay = document.createElement('div');
				overlay.id = '__iiitnr_overlay';
				overlay.style = 'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:24px;z-index:60;';
				overlay.innerHTML = `<div id="__iiitnr_backdrop" style="position:absolute;inset:0;background:rgba(2,6,23,.6);backdrop-filter: blur(3px);"></div><div id="__iiitnr_modal" style="position:relative;z-index:61;max-width:820px;width:100%;"></div>`;
				document.body.appendChild(overlay);
			}
			const modal = document.getElementById('__iiitnr_modal');
			if (modal) { 
				modal.innerHTML = ''; 
				modal.appendChild(contentEl); 
			}
			document.getElementById('__iiitnr_backdrop')?.addEventListener('click', closeOverlay);
		}

		function closeOverlay() { 
			const overlay = document.getElementById('__iiitnr_overlay'); 
			if (overlay) overlay.remove(); 
		}

		function openSettingsModal() {
			const currentBackendPref = localStorage.getItem('iiitnr.settings.useBackend') || 'auto';
			const savedTheme = localStorage.getItem(STORAGE_KEYS.theme) || 'light';
			const content = document.createElement('div');
			content.className = 'card p-8';
			content.innerHTML = `
				<div>
					<h3 class="text-2xl font-bold mb-6 text-gray-800 dark:text-white">Settings</h3>
					<div class="space-y-6">
						<div>
							<label class="label">Theme</label>
							<select id="settings-theme" class="input">
								<option value="light">Light</option>
								<option value="dark">Dark</option>
							</select>
						</div>
						<div>
							<label class="label">Data Source</label>
							<select id="settings-backend" class="input">
								<option value="auto">Auto (use backend if available)</option>
								<option value="backend">Always use backend</option>
								<option value="local">Always use localStorage</option>
							</select>
							<p class="text-sm text-muted mt-2">Toggle whether the app should prefer the backend API or local demo data.</p>
						</div>
					</div>
					<div class="flex justify-end gap-3 mt-8">
						<button id="settings-logout" class="btn bg-red-600 hover:bg-red-700 text-white">
							<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
							</svg>
							Logout
						</button>
						<button id="settings-cancel" class="btn bg-gray-200 hover:bg-gray-300 text-gray-800">Cancel</button>
						<button id="settings-save" class="btn bg-indigo-600 hover:bg-indigo-700 text-white">
							<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
							</svg>
							Save Changes
						</button>
					</div>
				</div>`;
			openOverlay(content);
			document.getElementById('settings-theme').value = savedTheme;
			document.getElementById('settings-backend').value = currentBackendPref;
			document.getElementById('settings-logout').addEventListener('click', (e) => {
				e.preventDefault();
				localStorage.removeItem(STORAGE_KEYS.currentUser);
				closeOverlay();
				setUserInHeader();
				window.location.hash = '#/login';
			});
			document.getElementById('settings-cancel').addEventListener('click', (e) => { 
				e.preventDefault(); 
				closeOverlay(); 
			});
			document.getElementById('settings-save').addEventListener('click', (e) => {
				e.preventDefault();
				const t = document.getElementById('settings-theme').value;
				const b = document.getElementById('settings-backend').value;
				localStorage.setItem(STORAGE_KEYS.theme, t);
				document.documentElement.setAttribute('data-theme', t);
				const text = document.getElementById('theme-toggle-text');
				if (text) text.textContent = t === 'dark' ? '☀️ Light Mode' : '🌙 Dark Mode';
				localStorage.setItem('iiitnr.settings.useBackend', b);
				if (b === 'backend') { 
					loadFromBackendOrLocal().then(()=>{ router(); }); 
				}
				closeOverlay();
			});
		}

		// Views
		async function renderLogin() {
			const app = document.getElementById('app');
			app.innerHTML = `
				<section class="max-w-5xl mx-auto p-4" style="animation: fadeInUp 0.6s ease-out;">
					<div class="text-center mb-8">
						<h1 class="text-4xl font-bold text-gray-800 dark:text-white mb-2">Welcome Back</h1>
						<p class="text-gray-600 dark:text-gray-400">Sign in to access your club dashboard</p>
					</div>
					<div class="grid md:grid-cols-2 gap-8">
						<!-- Student Login -->
						<div class="card p-8 border-l-4 border-indigo-500">
							<div class="flex items-center gap-4 mb-6">
								<div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg">
									<svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
									</svg>
								</div>
								<div>
									<h2 class="text-2xl font-bold text-gray-800 dark:text-white">Student Portal</h2>
									<p class="text-sm text-gray-600 dark:text-gray-400">For IIIT-NR students</p>
								</div>
							</div>
							<form id="student-login-form" class="space-y-4">
								<div>
									<label class="label">Full Name</label>
									<input class="input" id="stu-name" type="text" placeholder="Enter your name" required />
								</div>
								<div>
									<label class="label">Branch</label>
									<input class="input" id="stu-branch" type="text" placeholder="e.g. CSE, ECE, EEE" required />
								</div>
								<div>
									<label class="label">Academic Year</label>
									<select id="stu-year" class="input">
										<option value="1">1st Year</option>
										<option value="2">2nd Year</option>
										<option value="3">3rd Year</option>
										<option value="4">4th Year</option>
									</select>
								</div>
								<div>
									<label class="label">College Email</label>
									<input class="input" id="stu-email" type="email" placeholder="you@iiitnr.edu.in" required />
								</div>
								<div class="flex justify-between items-center pt-2">
									<button type="submit" class="btn bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white">
										<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
										</svg>
										Sign In
									</button>
									<a href="#/register" class="text-sm text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 font-medium">Register →</a>
								</div>
							</form>
						</div>

						<!-- Admin Login -->
						<div class="card p-8 border-l-4 border-rose-500">
							<div class="flex items-center gap-4 mb-6">
								<div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-rose-500 to-red-600 flex items-center justify-center shadow-lg">
									<svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
									</svg>
								</div>
								<div>
									<h2 class="text-2xl font-bold text-gray-800 dark:text-white">Admin Access</h2>
									<p class="text-sm text-gray-600 dark:text-gray-400">For administrators only</p>
								</div>
							</div>
							<form id="admin-login-form" class="space-y-4">
								<div>
									<label class="label">Admin Email</label>
									<input class="input" id="admin-email" type="email" placeholder="admin@iiitnr.ac.in" required />
								</div>
								<div>
									<label class="label">Password</label>
									<input class="input" id="admin-password" type="password" placeholder="••••••••" required />
								</div>
								<div class="pt-2">
									<button type="submit" class="btn bg-gradient-to-r from-rose-600 to-red-600 hover:from-rose-700 hover:to-red-700 text-white w-full">
										<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
										</svg>
										Admin Sign In
									</button>
								</div>
								<div class="bg-rose-50 dark:bg-rose-900/20 border border-rose-200 dark:border-rose-800 rounded-lg p-3">
									<p class="text-sm text-rose-700 dark:text-rose-400">
										<strong>Note:</strong> For administrative access only. Contact IT support if you need credentials.
									</p>
								</div>
							</form>
						</div>
					</div>
				</section>
			`;

			const studentForm = document.getElementById('student-login-form');
			studentForm.addEventListener('submit', async (e) => {
				e.preventDefault();
				const name = document.getElementById('stu-name').value.trim();
				const branch = document.getElementById('stu-branch').value.trim();
				const year = document.getElementById('stu-year').value;
				const email = document.getElementById('stu-email').value.trim();
				const user = { 
					id: 'u-1', 
					name: name || 'Student User', 
					branch, 
					year: Number(year), 
					email,
					role: 'student'
				};
				localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(user));
				handleSuccessfulLogin();
			});

			const adminForm = document.getElementById('admin-login-form');
			adminForm.addEventListener('submit', async (e) => {
				e.preventDefault();
				const email = document.getElementById('admin-email').value.trim();
				const password = document.getElementById('admin-password').value;

				if (email === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
					const adminUser = {
						id: 'admin-1',
						name: 'Administrator',
						email: email,
						role: 'admin',
						permissions: ['manage_clubs', 'manage_events', 'manage_heads', 'delete_clubs']
					};
					localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(adminUser));
					handleSuccessfulLogin();
				} else {
					alert('Invalid admin credentials. Please try again.');
				}
			});
		}

		async function handleSuccessfulLogin() {
			const pref = localStorage.getItem('iiitnr.settings.useBackend') || 'auto';
			if (pref === 'backend') {
				await loadFromBackendOrLocal();
			} else if (pref === 'auto') {
				const ok = await loadFromBackendOrLocal(); 
				if (!ok) await seedIfNeeded();
			} else {
				await seedIfNeeded();
			}
			setUserInHeader();
			window.location.hash = '#/';
			router();
		}

		async function renderHome() {
			const app = document.getElementById('app');
			const clubs = await getClubs();
			const totalMembers = clubs.reduce((sum, c) => sum + (c.memberIds?.length || 0), 0);
			const totalEvents = clubs.reduce((sum, c) => sum + (c.events?.length || 0), 0);

			app.innerHTML = `
				<section>
					<div class="hero-section p-12 mb-8 shadow-2xl text-white relative" style="animation: fadeInUp 0.6s ease-out;">
						<div class="relative z-10">
							<h1 class="text-5xl font-black mb-3 tracking-tight">Welcome to IIIT-NR Club Hub</h1>
							<p class="text-indigo-100 text-lg mb-8 max-w-2xl">Discover vibrant student communities, join exciting clubs, and participate in amazing events that shape your college experience.</p>
							<div class="flex flex-wrap gap-4">
								<a href="#/create" class="btn bg-white text-indigo-700 hover:bg-gray-50">
									<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
									</svg>
									Create New Club
								</a>
								<a href="#/support" class="btn glass-effect text-white hover:bg-white/20">
									<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z" />
									</svg>
									Get Support
								</a>
							</div>
						</div>
					</div>

					<!-- Stats Section -->
					<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8" style="animation: fadeInUp 0.6s ease-out 0.2s both;">
						<div class="stats-card">
							<div class="flex items-center justify-between">
								<div>
									<p class="text-sm font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide">Active Clubs</p>
									<p class="text-4xl font-black text-indigo-600 dark:text-indigo-400 mt-2">${clubs.length}</p>
								</div>
								<div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-3xl shadow-lg">
									🎯
								</div>
							</div>
						</div>
						<div class="stats-card">
							<div class="flex items-center justify-between">
								<div>
									<p class="text-sm font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide">Total Members</p>
									<p class="text-4xl font-black text-emerald-600 dark:text-emerald-400 mt-2">${totalMembers}</p>
								</div>
								<div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center text-white text-3xl shadow-lg">
									👥
								</div>
							</div>
						</div>
						<div class="stats-card">
							<div class="flex items-center justify-between">
								<div>
									<p class="text-sm font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide">Upcoming Events</p>
									<p class="text-4xl font-black text-amber-600 dark:text-amber-400 mt-2">${totalEvents}</p>
								</div>
								<div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center text-white text-3xl shadow-lg">
									📅
								</div>
							</div>
						</div>
					</div>

					<div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-6">
						<h2 class="text-3xl font-black text-gray-800 dark:text-white animate-slide-in">Explore Clubs</h2>
						<div class="relative w-full sm:w-96">
							<input id="search-input" 
								type="text" 
								placeholder="Search clubs by name or description..." 
								class="input w-full pl-12 transition-all duration-300"
								style="animation: fadeInUp 0.5s ease-out 0.4s both;" />
							<svg class="w-5 h-5 absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
							</svg>
						</div>
					</div>

					<div id="club-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
				</section>
			`;

			const search = document.getElementById('search-input');
			const render = (items) => renderClubCards(items);
			render(clubs);
			search?.addEventListener('input', (e) => {
				const q = e.target.value.toLowerCase();
				render(clubs.filter(c => c.name.toLowerCase().includes(q) || c.description.toLowerCase().includes(q)));
			});
		}

		function renderClubCards(clubs) {
			const list = document.getElementById('club-list');
			if (!list) return;
			list.innerHTML = '';
			
			if (clubs.length === 0) {
				list.innerHTML = `
					<div class="col-span-full text-center py-12">
						<div class="text-6xl mb-4">🔍</div>
						<h3 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">No clubs found</h3>
						<p class="text-gray-500 dark:text-gray-400">Try adjusting your search terms</p>
					</div>
				`;
				return;
			}

			clubs.forEach((club, index) => {
				const visuals = getClubVisuals(club.name);
				const card = document.createElement('div');
				card.className = 'card group p-6 cursor-pointer border-b-4 hover:border-indigo-500';
				card.style.animationDelay = `${index * 0.1}s`;
				card.classList.add('animate-stagger');
				card.innerHTML = `
					<div class="flex items-start mb-4">
						<div class="club-icon-wrapper ${visuals.bg} text-white mr-4">${visuals.emoji}</div>
						<div class="flex-grow min-w-0">
							<div class="flex items-center gap-2 mb-1">
								<h3 class="text-xl font-bold text-gray-800 dark:text-white group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition truncate">${club.name}</h3>
							</div>
							<span class="badge ${visuals.bg} text-white inline-block mb-2">${visuals.label}</span>
							<p class="text-gray-600 dark:text-gray-400 line-clamp-2 text-sm leading-relaxed">${club.description}</p>
						</div>
					</div>
					<div class="mt-4 pt-4 border-t border-gray-100 dark:border-gray-700 flex justify-between items-center">
						<div class="flex items-center gap-4 text-sm">
							<div class="flex items-center gap-1 text-gray-600 dark:text-gray-400">
								<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
									<path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
								</svg>
								<span class="font-semibold">${club.memberIds?.length || 0}</span>
							</div>
							<div class="flex items-center gap-1 text-gray-600 dark:text-gray-400">
								<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
									<path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
								</svg>
								<span class="font-semibold">${club.events?.length || 0}</span>
							</div>
						</div>
						<a href="#/club/${club.id}" class="btn bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white text-sm py-2 px-4">
							View Club
						</a>
					</div>
				`;
				list.appendChild(card);
			});
		}

		async function renderClubDetail(id) {
			const club = await getClubById(id);
			const user = getCurrentUser();
			const app = document.getElementById('app');
			
			if (!club) { 
				app.innerHTML = `
					<div class="card p-12 text-center">
						<div class="text-6xl mb-4">😞</div>
						<h2 class="text-2xl font-bold text-gray-700 dark:text-gray-300 mb-2">Club not found</h2>
						<p class="text-gray-500 dark:text-gray-400 mb-6">The club you're looking for doesn't exist.</p>
						<a href="#/" class="btn bg-indigo-600 hover:bg-indigo-700 text-white">Back to Home</a>
					</div>
				`; 
				return; 
			}

			const isMember = club.memberIds.includes(user?.id);
			const visuals = getClubVisuals(club.name);
			
			app.innerHTML = `
				<section class="club-detail" style="animation: fadeInUp 0.6s ease-out;">
					<div class="card p-8 border-t-4 ${visuals.bg}">
						<div class="flex flex-col lg:flex-row justify-between items-start gap-6 mb-8">
							<div class="flex items-start gap-6 flex-grow">
								<div class="club-icon-wrapper ${visuals.bg} text-white text-4xl">${visuals.emoji}</div>
								<div class="flex-grow">
									<h1 class="text-4xl font-black text-gray-800 dark:text-white mb-2" id="club-name">${club.name}</h1>
									<span class="badge ${visuals.bg} text-white mb-4 inline-block">${visuals.label}</span>
									<p class="text-gray-600 dark:text-gray-400 text-lg leading-relaxed" id="club-description">${club.description}</p>
									<div class="flex flex-wrap gap-6 mt-4">
										<div class="flex items-center gap-2">
											<svg class="w-5 h-5 text-indigo-600 dark:text-indigo-400" fill="currentColor" viewBox="0 0 20 20">
												<path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
											</svg>
											<span class="font-semibold text-gray-700 dark:text-gray-300">Head: <span id="club-leader" class="text-indigo-600 dark:text-indigo-400">${getLeaderName(club)}</span></span>
										</div>
										<div class="flex items-center gap-2">
											<svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
												<path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
											</svg>
											<span class="font-semibold text-gray-700 dark:text-gray-300">Members: <span id="club-member-count" class="text-emerald-600 dark:text-emerald-400">${String(club.memberIds.length)}</span></span>
										</div>
									</div>
									${(isAdmin() || club.leaderId === user?.id) ? `
									<div class="mt-4">
										<button id="edit-head-btn" class="btn bg-amber-500 hover:bg-amber-600 text-white text-sm">
											<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
											</svg>
											Edit Head
										</button>
										<form id="edit-head-form" class="hidden flex-col gap-3 mt-3 p-4 bg-amber-50 dark:bg-amber-900/20 rounded-xl">
											<label class="label">New Head Name</label>
											<div class="flex gap-2">
												<input id="edit-head-input" class="input flex-grow" type="text" placeholder="Enter new head name" value="${getLeaderName(club)}" />
												<button class="btn bg-indigo-600 hover:bg-indigo-700 text-white" type="submit">Save</button>
												<button class="btn bg-gray-200 hover:bg-gray-300 text-gray-800" type="button" id="cancel-edit-head">Cancel</button>
											</div>
										</form>
									</div>
									` : ''}
								</div>
							</div>
							<div class="flex flex-col gap-3">
								${!isAdmin() ? `
									<button id="join-leave-button" class="btn ${isMember ? 'bg-rose-600 hover:bg-rose-700' : 'bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700'} text-white">
										<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${isMember ? 'M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1' : 'M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z'}" />
										</svg>
										${isMember ? 'Leave Club' : 'Join Club'}
									</button>
								` : ''}
								${(isAdmin() || club.leaderId === user?.id) ? `
									<button id="delete-club-button" class="btn bg-red-600 hover:bg-red-700 text-white">
										<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
										</svg>
										Delete Club
									</button>
									${isAdmin() ? '<span class="px-3 py-2 rounded-xl bg-rose-100 dark:bg-rose-900/30 text-rose-800 dark:text-rose-300 text-xs font-bold text-center">🛡️ Admin Mode</span>' : ''}
								` : ''}
							</div>
						</div>

						<div class="grid lg:grid-cols-2 gap-8">
							<div>
								<h2 class="text-2xl font-black text-gray-800 dark:text-white mb-4 flex items-center gap-2">
									<svg class="w-6 h-6 text-indigo-600" fill="currentColor" viewBox="0 0 20 20">
										<path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
									</svg>
									Members
								</h2>
								<ul id="member-list" class="grid grid-cols-1 gap-2"></ul>
							</div>

							<div>
								<h2 class="text-2xl font-black text-gray-800 dark:text-white mb-4 flex items-center gap-2">
									<svg class="w-6 h-6 text-indigo-600" fill="currentColor" viewBox="0 0 20 20">
										<path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
									</svg>
									Upcoming Events
								</h2>
								<ul id="event-list" class="space-y-3"></ul>
							</div>
						</div>

						${club.leaderId === user?.id ? `
						<section class="mt-8 bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 p-6 rounded-2xl border-2 border-indigo-200 dark:border-indigo-800">
							<h3 class="text-2xl font-bold text-indigo-800 dark:text-indigo-300 mb-4 flex items-center gap-2">
								<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
								</svg>
								Create New Event
							</h3>
							<form id="event-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
								<div>
									<label class="label" for="event-name">Event Title</label>
									<input class="input" type="text" id="event-name" placeholder="Enter event title" required />
								</div>
								<div>
									<label class="label" for="event-date">Date & Time</label>
									<input class="input" type="datetime-local" id="event-date" required />
								</div>
								<div class="md:col-span-2">
									<label class="label" for="event-description">Description</label>
									<textarea class="input" id="event-description" rows="3" placeholder="Describe your event..." required></textarea>
								</div>
								<div class="md:col-span-2 flex justify-end">
									<button type="submit" class="btn bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white">
										<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
										</svg>
										Post Event
									</button>
								</div>
							</form>
						</section>
						` : ''}
					</div>
				</section>
			`;

			// Members
			const list = document.getElementById('member-list');
			list.innerHTML = '';
			if (club.memberIds.length === 0) {
				list.innerHTML = '<li class="text-gray-500 dark:text-gray-400 text-sm italic">No members yet</li>';
			} else {
				(club.memberIds || []).forEach(idm => {
					const li = document.createElement('li');
					li.className = 'px-4 py-3 rounded-xl bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-800 border border-gray-200 dark:border-gray-600 flex items-center gap-2';
					li.innerHTML = `
						<svg class="w-4 h-4 text-indigo-600 dark:text-indigo-400" fill="currentColor" viewBox="0 0 20 20">
							<path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
						</svg>
						<span class="font-medium text-gray-700 dark:text-gray-300">${idm === user?.id ? `${idm} (You)` : idm}</span>
					`;
					list.appendChild(li);
				});
			}

			// Events
			const eventList = document.getElementById('event-list');
			eventList.innerHTML = '';
			if (!club.events || club.events.length === 0) {
				eventList.innerHTML = '<li class="text-gray-500 dark:text-gray-400 text-sm italic">No upcoming events</li>';
			} else {
				(club.events || []).forEach(ev => {
					const rsvpCount = ev.rsvpUserIds?.length || 0;
					const hasRsvped = ev.rsvpUserIds?.includes(user?.id);
					const li = document.createElement('li');
					li.innerHTML = `
						<div class="card p-4 border-l-4 border-indigo-500">
							<div class="flex items-start justify-between mb-2">
								<h4 class="text-lg font-bold text-gray-800 dark:text-white">${ev.title}</h4>
								${hasRsvped ? '<span class="badge bg-emerald-600 text-white text-xs">✓ RSVP\'d</span>' : ''}
							</div>
							<p class="text-gray-600 dark:text-gray-400 text-sm mb-3">${ev.description}</p>
							<div class="flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mb-3">
								<div class="flex items-center gap-1">
									<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
										<path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
									</svg>
									${ev.date}
								</div>
								<div class="flex items-center gap-1">
									<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
										<path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
									</svg>
									<span data-rsvp-count="${ev.id}" class="font-semibold">${rsvpCount}</span> RSVPs
								</div>
							</div>
							<div class="flex gap-2 flex-wrap actions-row">
								<button class="btn ${hasRsvped ? 'bg-gray-500 hover:bg-gray-600' : 'bg-emerald-600 hover:bg-emerald-700'} text-white text-sm" data-rsvp="${ev.id}">
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${hasRsvped ? 'M6 18L18 6M6 6l12 12' : 'M5 13l4 4L19 7'}" />
									</svg>
									${hasRsvped ? 'Cancel RSVP' : 'RSVP Now'}
								</button>
							</div>
						</div>
					`;

					if (club.leaderId === user?.id) {
						const actions = li.querySelector('.actions-row');
						if (actions) {
							const editBtn = document.createElement('button');
							editBtn.className = 'btn bg-amber-500 hover:bg-amber-600 text-white text-sm';
							editBtn.innerHTML = `
								<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
								</svg>
								Edit
							`;
							editBtn.dataset.edit = ev.id;
							actions.appendChild(editBtn);
							editBtn.addEventListener('click', () => {
								const content = document.createElement('div');
								content.className = 'card p-8';
								content.innerHTML = `
									<div>
										<h3 class="text-2xl font-bold mb-6 text-gray-800 dark:text-white">Edit Event</h3>
										<form id="edit-event-form" class="grid grid-cols-1 gap-4">
											<div>
												<label class="label">Title</label>
												<input id="edit-event-title" class="input" type="text" required />
											</div>
											<div>
												<label class="label">Date & Time</label>
												<input id="edit-event-date" class="input" type="datetime-local" required />
											</div>
											<div>
												<label class="label">Description</label>
												<textarea id="edit-event-desc" class="input" rows="4" required></textarea>
											</div>
											<div class="flex justify-end gap-3">
												<button type="button" id="edit-cancel" class="btn bg-gray-200 hover:bg-gray-300 text-gray-800">Cancel</button>
												<button type="submit" class="btn bg-indigo-600 hover:bg-indigo-700 text-white">
													<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
														<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
													</svg>
													Save Changes
												</button>
											</div>
										</form>
									</div>`;
								openOverlay(content);
								document.getElementById('edit-event-title').value = ev.title || '';
								try {
									const d = new Date(ev.date || ev.datetime || Date.now());
									const tzOffset = d.getTimezoneOffset();
									const local = new Date(d.getTime() - tzOffset * 60000);
									document.getElementById('edit-event-date').value = local.toISOString().slice(0,16);
								} catch(e) { }
								document.getElementById('edit-event-desc').value = ev.description || '';
								document.getElementById('edit-cancel').addEventListener('click', (e) => { e.preventDefault(); closeOverlay(); });
								document.getElementById('edit-event-form').addEventListener('submit', async (e) => {
									e.preventDefault();
									const newTitle = document.getElementById('edit-event-title').value.trim();
									const newDesc = document.getElementById('edit-event-desc').value.trim();
									const newDate = document.getElementById('edit-event-date').value;
									await updateEvent(ev.id, { title: newTitle, description: newDesc, date: newDate });
									closeOverlay();
									renderClubDetail(id);
								});
							});
						}
					}
					li.querySelector('[data-rsvp]').addEventListener('click', async () => {
						const updated = await toggleEventRsvp(club.id, ev.id);
						if (updated) renderClubDetail(id);
					});
					eventList.appendChild(li);
				});
			}

			// Join/Leave
			document.getElementById('join-leave-button')?.addEventListener('click', async () => {
				const fresh = await getClubById(id);
				if (fresh.memberIds.includes(user?.id)) await leaveClub(id); 
				else await joinClub(id);
				renderClubDetail(id);
			});

			// Delete club
			const deleteBtn = document.getElementById('delete-club-button');
			if (deleteBtn) {
				deleteBtn.addEventListener('click', async () => {
					if (!confirm('Are you sure you want to DELETE this club? This action cannot be undone.')) return;
					try {
						if (backendAvailable) {
							await apiDelete(`/clubs/${id}`);
							await loadFromBackendOrLocal();
						} else {
							const clubs = await getClubs();
							const idx = clubs.findIndex(c => String(c.id) === String(id));
							if (idx !== -1) { clubs.splice(idx, 1); await saveClubs(clubs); }
						}
						window.location.hash = '#/';
					} catch (err) {
						console.error('Delete club failed:', err);
						alert('Failed to delete club. See console for details.');
					}
				});
			}

			// Edit club head
			const editBtn = document.getElementById('edit-head-btn');
			const form = document.getElementById('edit-head-form');
			const cancelBtn = document.getElementById('cancel-edit-head');
			if (editBtn && form && cancelBtn) {
				editBtn.addEventListener('click', () => {
					form.classList.remove('hidden');
					form.classList.add('flex');
				});
				cancelBtn.addEventListener('click', () => {
					form.classList.add('hidden');
					form.classList.remove('flex');
				});
				form.addEventListener('submit', async (e) => {
					e.preventDefault();
					const newName = document.getElementById('edit-head-input').value;
					await updateClubLeaderName(id, newName);
					renderClubDetail(id);
				});
			}

			// Owner event form
			const eventForm = document.getElementById('event-form');
			if (eventForm && club.leaderId === user?.id) {
				eventForm.addEventListener('submit', async (e) => {
					e.preventDefault();
					await addEventToClub(id, {
						title: document.getElementById('event-name').value,
						description: document.getElementById('event-description').value,
						date: document.getElementById('event-date').value
					});
					renderClubDetail(id);
					eventForm.reset();
				});
			}
		}

		async function renderCreateClub() {
			const app = document.getElementById('app');
			app.innerHTML = `
				<section style="animation: fadeInUp 0.6s ease-out;">
					<div class="card p-8 sm:p-12 max-w-3xl mx-auto border-t-4 border-indigo-600">
						<div class="text-center mb-8">
							<div class="w-20 h-20 rounded-3xl bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white text-4xl mx-auto mb-4 shadow-xl">
								🎯
							</div>
							<h1 class="text-4xl font-black text-gray-800 dark:text-white mb-2">Create a New Club</h1>
							<p class="text-gray-600 dark:text-gray-400">Start building your community at IIIT-NR</p>
						</div>
						<form id="create-club-form" class="space-y-6">
							<div>
								<label class="label" for="club-name">Club Name</label>
								<input class="input" type="text" id="club-name" name="club-name" placeholder="e.g. Robotics Club, Photography Society" required />
							</div>
							<div>
								<label class="label" for="club-description">Description</label>
								<textarea class="input" id="club-description" name="club-description" rows="5" placeholder="Describe what your club is about, activities, and goals..." required></textarea>
							</div>
							<div class="flex justify-end gap-3 pt-4">
								<a href="#/" class="btn bg-gray-200 hover:bg-gray-300 text-gray-800">Cancel</a>
								<button type="submit" class="btn bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white">
									<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
									</svg>
									Create Club
								</button>
							</div>
						</form>
					</div>
				</section>
			`;
			const form = document.getElementById('create-club-form');
			form.addEventListener('submit', async (e) => {
				e.preventDefault();
				const name = document.getElementById('club-name').value.trim();
				const description = document.getElementById('club-description').value.trim();
				if (!name || !description) return;
				const created = await createClub({ name, description });
				if (created) window.location.hash = `#/club/${created.id}`;
			});
		}

		async function renderSupport() {
			const app = document.getElementById('app');
			app.innerHTML = `
				<section style="animation: fadeInUp 0.6s ease-out;">
					<div class="card p-8 sm:p-12 max-w-3xl mx-auto">
						<div class="text-center mb-8">
							<div class="w-20 h-20 rounded-3xl bg-gradient-to-br from-sky-600 to-cyan-600 flex items-center justify-center text-white text-4xl mx-auto mb-4 shadow-xl">
								💬
							</div>
							<h1 class="text-4xl font-black text-gray-800 dark:text-white mb-2">Contact Support</h1>
							<p class="text-gray-600 dark:text-gray-400">Have an issue or feedback? We're here to help!</p>
						</div>
						<div class="bg-gradient-to-r from-sky-50 to-cyan-50 dark:from-sky-900/20 dark:to-cyan-900/20 border border-sky-200 dark:border-sky-800 rounded-xl p-4 mb-6">
							<p class="text-sm text-gray-700 dark:text-gray-300">
								<strong>Official Website:</strong> 
								<a href="https://www.iiitnr.ac.in/" target="_blank" rel="noopener" class="text-sky-600 hover:text-sky-700 dark:text-sky-400 font-medium underline">
									https://www.iiitnr.ac.in/
								</a>
							</p>
						</div>
						<form id="support-form" class="space-y-6">
							<div>
								<label class="label" for="support-name">Your Name</label>
								<input class="input" id="support-name" type="text" placeholder="Enter your full name" required />
							</div>
							<div>
								<label class="label" for="support-email">Email Address</label>
								<input class="input" id="support-email" type="email" placeholder="you@iiitnr.edu.in" required />
							</div>
							<div>
								<label class="label" for="support-message">Message</label>
								<textarea class="input" id="support-message" rows="6" placeholder="Tell us how we can help you..." required></textarea>
							</div>
							<button class="btn bg-gradient-to-r from-sky-600 to-cyan-600 hover:from-sky-700 hover:to-cyan-700 text-white w-full" type="submit">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
								</svg>
								Send Message
							</button>
						</form>
						<p id="support-status" class="hidden mt-6 text-center p-4 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-xl">
							<svg class="w-6 h-6 text-emerald-600 dark:text-emerald-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
							</svg>
							<span class="text-emerald-700 dark:text-emerald-300 font-semibold">Thanks! Your message has been recorded.</span>
						</p>
					</div>
				</section>
			`;
			const form = document.getElementById('support-form');
			form.addEventListener('submit', async (e) => {
				e.preventDefault();
				const entry = {
					name: document.getElementById('support-name').value,
					email: document.getElementById('support-email').value,
					message: document.getElementById('support-message').value,
					date: new Date().toISOString()
				};
				let saved = false;
				if (backendAvailable) {
					try {
						await apiPost('/support', entry);
						saved = true;
					} catch (err) {
						console.warn('Support POST failed, saving locally', err && err.message ? err.message : err);
					}
				}
				if (!saved) {
					const key = 'iiitnr.support.tickets';
					const existing = JSON.parse(localStorage.getItem(key) || '[]');
					existing.push(entry);
					localStorage.setItem(key, JSON.stringify(existing));
				}
				document.getElementById('support-status').classList.remove('hidden');
				form.reset();
			});
		}

		// Router
		function parseRoute() {
			const hash = window.location.hash || '#/';
			const parts = hash.replace(/^#\//, '').split('/');
			if (!parts[0]) return { name: 'home' };
			if (parts[0] === 'create') return { name: 'create' };
			if (parts[0] === 'club' && parts[1]) return { name: 'club', id: parts[1] };
			if (parts[0] === 'login') return { name: 'login' };
			if (parts[0] === 'register') return { name: 'register' };
			if (parts[0] === 'support') return { name: 'support' };
			return { name: 'home' };
		}

		async function router() {
			await seedIfNeeded();
			setUserInHeader();
			applySavedTheme();
			setupThemeToggle();
			updateSideAuthActions();

			const route = parseRoute();
			if (route.name === 'home') return renderHome();
			if (route.name === 'create') return renderCreateClub();
			if (route.name === 'club') return renderClubDetail(route.id);
			if (route.name === 'login') return renderLogin();
			if (route.name === 'support') return renderSupport();
			return renderHome();
		}

		window.addEventListener('hashchange', router);
		window.addEventListener('DOMContentLoaded', async () => {
			applySavedTheme();
			setupThemeToggle();
			setUserInHeader();

			const currentUser = localStorage.getItem(STORAGE_KEYS.currentUser);
			if (!currentUser) {
				window.location.hash = '#/login';
				renderLogin();
				return;
			}

			const pref = localStorage.getItem('iiitnr.settings.useBackend') || 'auto';
			if (pref === 'backend') {
				await loadFromBackendOrLocal();
				if (!backendAvailable) console.info('Backend not reachable (forced).');
			} else if (pref === 'auto') {
				const ok = await loadFromBackendOrLocal();
				if (!ok) await seedIfNeeded();
			} else {
				await seedIfNeeded();
			}

			router();
		});

		// Digital clocks
		function pad(n) { return String(n).padStart(2, '0'); }
		function updateDigitalClocks() {
			const now = new Date();
			const local = `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
			const utc = `${pad(now.getUTCHours())}:${pad(now.getUTCMinutes())}:${pad(now.getUTCSeconds())}`;
			const localEl = document.getElementById('digital-local');
			const utcEl = document.getElementById('digital-utc');
			if (localEl) localEl.textContent = local;
			if (utcEl) utcEl.textContent = utc;
		}

		setInterval(updateDigitalClocks, 1000);
		updateDigitalClocks();

		// Side Menu
		document.addEventListener('DOMContentLoaded', () => {
			const menuBtn = document.getElementById('menu-btn');
			const closeBtn = document.getElementById('close-menu');
			const sideMenu = document.getElementById('side-menu');
			const backdrop = document.getElementById('menu-backdrop');
			const sideSettingsBtn = document.getElementById('side-settings-btn');
			const sideThemeToggle = document.getElementById('side-theme-toggle');

			function openMenu() {
				sideMenu.classList.remove('-translate-x-full');
				backdrop.classList.add('opacity-100');
				backdrop.classList.remove('pointer-events-none');
				const spans = menuBtn.querySelectorAll('span');
				spans[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
				spans[1].style.opacity = '0';
				spans[2].style.transform = 'rotate(-45deg) translate(5px, -5px)';
			}

			function closeMenu() {
				sideMenu.classList.add('-translate-x-full');
				backdrop.classList.remove('opacity-100');
				backdrop.classList.add('pointer-events-none');
				const spans = menuBtn.querySelectorAll('span');
				spans[0].style.transform = '';
				spans[1].style.opacity = '1';
				spans[2].style.transform = '';
			}

			menuBtn.addEventListener('click', openMenu);
			closeBtn.addEventListener('click', closeMenu);
			backdrop.addEventListener('click', closeMenu);

			sideSettingsBtn.addEventListener('click', () => {
				closeMenu();
				openSettingsModal();
			});

			sideThemeToggle.addEventListener('click', () => {
				const current = document.documentElement.getAttribute('data-theme') || 'light';
				const next = current === 'dark' ? 'light' : 'dark';
				document.documentElement.setAttribute('data-theme', next);
				localStorage.setItem(STORAGE_KEYS.theme, next);
				const text = document.getElementById('theme-toggle-text');
				if (text) text.textContent = next === 'dark' ? '☀️ Light Mode' : '🌙 Dark Mode';
			});

			updateSideAuthActions();
			window.addEventListener('hashchange', updateSideAuthActions);
		});

		function updateSideAuthActions() {
			const sideAuthActions = document.getElementById('side-auth-actions');
			const user = getCurrentUser();
			
			if (sideAuthActions) {
				if (user) {
					sideAuthActions.innerHTML = `
						<div class="px-4 py-3 rounded-xl bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 border border-indigo-200 dark:border-indigo-800">
							<div class="text-xs text-gray-600 dark:text-gray-400 mb-1">Signed in as</div>
							<div class="font-bold text-gray-800 dark:text-white">${user.name}</div>
							${user.role === 'admin' ? '<div class="text-xs text-rose-600 dark:text-rose-400 font-semibold mt-1">🛡️ Administrator</div>' : ''}
						</div>
						<button id="side-logout" class="menu-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20">
							<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
							</svg>
							Logout
						</button>
					`;
					document.getElementById('side-logout')?.addEventListener('click', () => {
						localStorage.removeItem(STORAGE_KEYS.currentUser);
						const menu = document.getElementById('side-menu');
						if (menu) menu.classList.add('-translate-x-full');
						const backdrop = document.getElementById('menu-backdrop');
						if (backdrop) {
							backdrop.classList.remove('opacity-100');
							backdrop.classList.add('pointer-events-none');
						}
						window.location.hash = '#/login';
						router();
					});
				} else {
					sideAuthActions.innerHTML = `
						<a href="#/login" class="menu-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 dark:text-gray-200">
							<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
							</svg>
							Login
						</a>
					`;
				}
			}
		}
	</script>
</body>
</html>
